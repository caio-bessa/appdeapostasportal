# ğŸ—ï¸ ARQUITETURA - AppdeApostas.com.br

## ğŸ“Š **DIAGRAMA ARQUITETURAL**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ğŸŒ CLOUDFLARE CDN                        â”‚
â”‚  â€¢ SSL/TLS Termination   â€¢ DDoS Protection   â€¢ Global Cache    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚ HTTPS/HTTP2
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ–¥ï¸  AWS EC2 INSTANCE                         â”‚
â”‚                 Amazon Linux 2023 (3.18.213.189)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   ğŸ”„ PM2         â”‚    â”‚          ğŸ”§ NGINX                    â”‚ â”‚
â”‚  â”‚   Process Mgr    â”‚    â”‚      Reverse Proxy                  â”‚ â”‚
â”‚  â”‚                  â”‚    â”‚   Port 80 â†’ SSL Redirect           â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚   Port 443 â†’ Load Balance          â”‚ â”‚
â”‚  â”‚  â”‚ Backend     â”‚ â”‚    â”‚                                     â”‚ â”‚
â”‚  â”‚  â”‚ (Strapi)    â”‚â—„â”¼â”€â”€â”€â”€â”¼â”€â”€ :1337 â—„â”€â”                        â”‚ â”‚
â”‚  â”‚  â”‚ Port 1337   â”‚ â”‚    â”‚             â”‚                       â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚             â”‚                       â”‚ â”‚
â”‚  â”‚                  â”‚    â”‚             â”‚                       â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚   :3005 â—„â”€â”€â”€â”¼â”€â”                     â”‚ â”‚
â”‚  â”‚  â”‚ Frontend    â”‚ â”‚    â”‚             â”‚ â”‚                     â”‚ â”‚
â”‚  â”‚  â”‚ (Next.js)   â”‚â—„â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                     â”‚ â”‚
â”‚  â”‚  â”‚ Port 3005   â”‚ â”‚    â”‚               â”‚                     â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚                       â”‚
â”‚                                          â”‚                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚                       â”‚
â”‚  â”‚   ğŸ“ SQLITE      â”‚                     â”‚                       â”‚
â”‚  â”‚   Database       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚  â”‚   .tmp/data.db   â”‚                                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚  ğŸ” Certbot      â”‚    â”‚  ğŸ“‚ File System â”‚                     â”‚
â”‚  â”‚  Let's Encrypt   â”‚    â”‚  Static Assets  â”‚                     â”‚
â”‚  â”‚  Auto SSL        â”‚    â”‚  Uploads        â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ **STACK TÃ‰CNICO**

### **Frontend Layer**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             FRONTEND STACK              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Framework: Next.js 15.5.2             â”‚
â”‚  Language:  TypeScript                  â”‚
â”‚  Styling:   Tailwind CSS               â”‚
â”‚  UI Lib:    React 18                   â”‚
â”‚  Icons:     Lucide React               â”‚
â”‚  HTTP:      Axios                      â”‚
â”‚  Port:      3005                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Backend Layer**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             BACKEND STACK               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  CMS:       Strapi 4.25.9              â”‚
â”‚  Runtime:   Node.js 20.19.4            â”‚
â”‚  Database:  SQLite                     â”‚
â”‚  Auth:      Strapi Built-in            â”‚
â”‚  API:       REST + GraphQL             â”‚
â”‚  Port:      1337                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Infrastructure Layer**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          INFRASTRUCTURE STACK          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Cloud:     AWS EC2                    â”‚
â”‚  OS:        Amazon Linux 2023          â”‚
â”‚  Proxy:     Nginx 1.28.0               â”‚
â”‚  Process:   PM2 6.0.10                 â”‚
â”‚  SSL:       Let's Encrypt (Certbot)    â”‚
â”‚  CDN:       Cloudflare                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸŒ **FLUXO DE DADOS**

### **RequisiÃ§Ã£o Web (https://appdeapostas.com.br)**
```
ğŸ“± Cliente
    â†“ HTTPS
ğŸŒ Cloudflare CDN
    â†“ Cache Miss/Dynamic
â˜ï¸  AWS EC2 (3.18.213.189)
    â†“ Port 443
ğŸ”§ Nginx Reverse Proxy
    â†“ Proxy Pass
âš›ï¸  Next.js Frontend (Port 3005)
    â†“ API Calls
ğŸ¯ Strapi Backend (Port 1337)
    â†“ Query
ğŸ“ SQLite Database (.tmp/data.db)
```

### **Admin CMS (https://appdeapostas.com.br/admin)**
```
ğŸ‘¤ Admin User
    â†“ HTTPS
ğŸŒ Cloudflare CDN
    â†“ 
â˜ï¸  AWS EC2
    â†“ Port 443
ğŸ”§ Nginx (/admin path)
    â†“ Proxy Pass
ğŸ›ï¸  Strapi Admin (Port 1337/admin)
    â†“ CRUD Operations
ğŸ“ SQLite Database
```

## ğŸ”’ **SEGURANÃ‡A**

### **Headers Implementados**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            SECURITY HEADERS             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  X-Frame-Options: SAMEORIGIN           â”‚
â”‚  X-Content-Type-Options: nosniff       â”‚
â”‚  X-XSS-Protection: 1; mode=block       â”‚
â”‚  Strict-Transport-Security: max-age=.. â”‚
â”‚  Referrer-Policy: strict-origin-when.. â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **SSL/TLS**
```
ğŸ” Let's Encrypt Certificate
   â”œâ”€â”€ Auto-renewal configurado
   â”œâ”€â”€ HSTS habilitado
   â”œâ”€â”€ HTTP â†’ HTTPS redirect
   â””â”€â”€ TLS 1.2+ only
```

## âš¡ **PERFORMANCE**

### **Cache Strategy**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CACHE LAYERS               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  L1: Cloudflare Edge Cache (Global)    â”‚
â”‚  L2: Nginx Static Files (Local)        â”‚
â”‚  L3: Next.js Build Cache (App)         â”‚
â”‚  L4: SQLite Query Cache (DB)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **OtimizaÃ§Ãµes**
- **Gzip/Brotli:** CompressÃ£o automÃ¡tica
- **HTTP/2:** Multiplexing habilitado  
- **Static Assets:** Cache de 1 ano
- **API Responses:** Cache inteligente

## ğŸ“ **ESTRUTURA DE ARQUIVOS**

```
appdeapostasportal/
â”œâ”€â”€ ğŸ“ frontend/appdeapostas/     # Next.js App
â”‚   â”œâ”€â”€ src/app/                 # App Router
â”‚   â”œâ”€â”€ src/components/          # React Components  
â”‚   â”œâ”€â”€ src/lib/                 # Utilities
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ ğŸ“ backend/                  # Strapi CMS
â”‚   â”œâ”€â”€ src/api/                 # Content Types
â”‚   â”œâ”€â”€ config/                  # Configurations
â”‚   â”œâ”€â”€ .tmp/                    # SQLite DB
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ ğŸ“ scripts/                  # Deploy Scripts
â”œâ”€â”€ ğŸ”§ ecosystem.config.js       # PM2 Config
â”œâ”€â”€ ğŸ”§ deploy-to-server.sh       # Deploy Script
â””â”€â”€ ğŸ“‹ README.md                 # Documentation
```

## ğŸš€ **DEPLOYMENT FLOW**

```
1. ğŸ’» Development
   â””â”€â”€ Local: npm run dev (Frontend + Backend)

2. ğŸ“¦ Build
   â”œâ”€â”€ Frontend: next build
   â”œâ”€â”€ Backend: strapi build  
   â””â”€â”€ Package: tar.gz creation

3. ğŸš€ Deploy
   â”œâ”€â”€ SSH to EC2
   â”œâ”€â”€ Upload files
   â”œâ”€â”€ Install dependencies
   â”œâ”€â”€ PM2 restart
   â””â”€â”€ Nginx reload

4. âœ… Verification
   â”œâ”€â”€ Health checks
   â”œâ”€â”€ SSL validation
   â””â”€â”€ Performance tests
```

## ğŸ“Š **MONITORAMENTO**

### **Logs Locations**
```
/home/ec2-user/appdeapostas-native/logs/
â”œâ”€â”€ backend-error.log      # Strapi errors
â”œâ”€â”€ backend-out.log        # Strapi output  
â”œâ”€â”€ frontend-error.log     # Next.js errors
â”œâ”€â”€ frontend-out.log       # Next.js output
â””â”€â”€ nginx/                 # Nginx access/error logs
```

### **Key Metrics**
- **Uptime:** PM2 status monitoring
- **Performance:** Response times < 1s
- **SSL:** Auto-renewal monitoring  
- **Security:** Header validation

---

*ğŸ“ Arquitetura robusta, escalÃ¡vel e production-ready!*